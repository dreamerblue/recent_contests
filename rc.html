<!-- Copyright (c) 2016 bLue -->
<!-- Github: dreamerblue -->

<!DOCTYPE html>
<html>
<head>
<meta http-equiv="cache-control" content="no-cache">
<meta http-equiv="expires" content="0">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="refresh" content="600">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="favicon.ico">
<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdn.bootcss.com/html5shiv/r29/html5.min.js"></script>
<style>
body {
	font-family: "Helvetica Neue", Helvetica, "Microsoft Yahei", Arial, sans-serif;
}
.mgdiv {
	text-align: center;
	margin-top: 20px;
	margin-bottom: 20px;
}
th, td {
	text-align: center;
}
.text-left {
	text-align: left;
}
#loading {
	margin: 12px 0;
	text-align: center;
}
#loading p {
	margin-bottom: 8px;
}
strong {
	font-size: 116%;
}
#table, #footer {
	display: none;
}
#footer p {
	margin-bottom: 0px;
}
</style>
<title>Recent Contests</title>
</head>
<body id="main_body">
<div class="container">
	<div class="row-fluid">
		<div class="mgdiv">
			<h3>Recent Contests</h3>
		</div>
		<div class="span12">
			<div class="table-responsive">
				<div id="loading">
					<p><strong>Loading...</strong></p><p>If no data loaded, refresh page please</p>
				</div>
				<table id="table" class="table table-striped table-bordered">
					<thead></thead>
					<tbody></tbody>
				</table>
			</div>
		</div>
		<div id="footer" class="mgdiv">
			<p>Copyright &copy; 2016-2017 <a href="https://helloblue.net" target="_blank">bLue</a></p>
			<p>Version 1.0.2</p>
			<!-- <p><a href="download/rc.crx" target="_blank">Download Chrome Extension</a></p> -->
			<p><a href="https://github.com/dreamerblue/recent_contests" target="_blank">GitHub</a></p>
			<!-- <p><a href download="bLue.recent_contests.html">Download Source Code (HTML5 only)</a></p> -->
			<p><a href="https://contests.acmicpc.info/contests.json" target="_blank">Data Source</a></p>
		</div>
	</div>
</div>
<script>
$(document).ready(function() {
	var timestamp = new Date().getTime();
	$.ajax({
		url: "https://query.yahooapis.com/v1/public/yql",
		dataType: "jsonp",
		data: {
			q: 'select * from json where url="https://contests.acmicpc.info/contests.json?callback=' + timestamp + '"',
			format: "json",
		timeout: 10000
		},
		success: function (res) {
			$("#loading").animate({opacity: "hide"}, 0);
			json = res.query.results.json.json;
			var tr = $('<tr></tr>');
			tr.appendTo($("thead"));
			$('<th>OJ</th>').appendTo(tr);
			$('<th class="text-left">&nbsp;&nbsp;Name</th>').appendTo(tr);
			$('<th>Start Time</th>').appendTo(tr);
			$('<th>Week</th>').appendTo(tr);
			$('<th>Access</th>').appendTo(tr);
			for(var i=0, len=json.length; i<len; ++i) {
				var tr = $('<tr></tr>');
				tr.appendTo($("tbody"));
				$('<td>' + json[i].oj + '</td>').appendTo(tr);
				$('<td class="text-left">&nbsp;&nbsp;<a href="' + json[i].link + '" target="_blank">' + json[i].name + '</a></td>').appendTo(tr);
				$('<td>' + json[i].start_time + '</td>').appendTo(tr);
				$('<td>' + json[i].week + '</td>').appendTo(tr);
				$('<td>' + json[i].access + '</td>').appendTo(tr);
				var start_time = new Date(json[i].start_time.replace(/-/g,"/"));
				var now_time = new Date();
				var secs = (start_time-now_time)/1000;
				if(secs <= 0)
					tr.addClass("danger");
				else if(Math.floor(secs/3600/24) < 3)
					tr.addClass("info");
			}
			$("#table").animate({opacity: "show"}, 250);
			$("#footer").animate({opacity: "show"}, 250);
		}, error: function () {
			// alert("Error Occurred! Please contact authorï¼štbdblue@gmail.com");
		}
	});
});
</script>
</body>
</html>